# k3s

## setup

```sh
# export no_proxy=127.0.0.0/8,10.0.0.0/8,192.168.0.0/16,localhost
curl -sfL https://get.k3s.io | sh -s - --service-node-port-range 1-65535  --write-kubeconfig-mode 0644
```

### advanced

#### proxy

`/etc/systemd/system/k3s.service.env`

```sh
http_proxy=http://localhost:8080
https_proxy=http://localhost:8080
no_proxy=127.0.0.0/8,10.0.0.0/8,192.168.0.0/16,localhost
```

#### registries

[k3s レジストリーミラーリングの有効化](https://docs.k3s.io/ja/installation/registry-mirror#%E3%83%AC%E3%82%B8%E3%82%B9%E3%83%88%E3%83%AA%E3%83%9F%E3%83%A9%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E6%9C%89%E5%8A%B9%E5%8C%96)

`/etc/rancher/k3s/registries.yaml`

```sh
mirrors:
  docker.io:
    endpoint:
      - "http://xxx:5000"
```

reflect

```sh
sudo systemctl restart k3s

# autogenerated file
sudo ls /var/lib/rancher/k3s/agent/etc/containerd/certs.d/docker.io/hosts.toml
```

## install bash completion

[doc](https://gist.github.com/Piotr1215/129fc794bf5d24efc3a7d3fcc9d1761f)

```sh
source <(k3s completion bash)
echo "source <(k3s completion bash)" >> ~/.bashrc
alias k=kubectl
complete -F __start_kubectl k
```

## check

```sh
k get node
```
